name: Deploy SEO Content to studybuddy.works

on:
  push:
    branches: [ main ]
    paths:
      - 'pseo-output/**'
      - 'pseo-output-conversion/**'
      - 'seo-content/**'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  deploy-seo:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Checkout SEO repository
        uses: actions/checkout@v4
        with:
          repository: oatswrldwide/studybuddy-south-africa
          token: ${{ secrets.GH_PAT }}
          path: seo-repo
          fetch-depth: 0
      
      - name: Copy SEO content to SEO repository
        run: |
          # Copy all SEO content files
          cp -r pseo-output/* seo-repo/ 2>/dev/null || true
          cp -r pseo-output-conversion/* seo-repo/ 2>/dev/null || true
          cp -r seo-content/* seo-repo/ 2>/dev/null || true
          
          # Create CNAME file for custom domain
          echo "studybuddy.works" > seo-repo/CNAME
          
          # Create or update README
          cat > seo-repo/README.md << 'EOFREADME'
          # StudyBuddy South Africa - SEO Landing Pages
          
          Live Site: https://studybuddy.works
          
          This repository contains programmatic SEO content for StudyBuddy AI.
          
          ## Content Structure
          
          - Subject Pages: Mathematics, Physical Sciences, Life Sciences by grade
          - Pain Point Pages: Targeted landing pages for specific student problems
          - Comparison Pages: AI tutor vs traditional tutoring
          
          ## Deployment
          
          - Content is automatically synced from the main study-buddy-ai repository
          - Deployed to GitHub Pages at studybuddy.works
          - Updates happen on every push to main branch
          
          ## Manual Testing
          
          Visit: https://studybuddy.works
          EOFREADME
      
      - name: Commit and push to SEO repository
        working-directory: seo-repo
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"
          git add .
          
          # Only commit if there are changes
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Auto-sync SEO content from study-buddy-ai [$(date +'%Y-%m-%d %H:%M:%S')]"
            git push origin main
            echo "✅ SEO content successfully synced to studybuddy-south-africa"
            echo "✅ Will be deployed to studybuddy.works via GitHub Pages"
          fi
